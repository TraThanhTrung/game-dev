# Verification Checklist - Exp Logic Removal and ExpToLevel Implementation

## âœ… Config Changes

- [x] **shared/game-config.json**

  - basePerLevel: 100 â†’ 10 âœ…
  - growthMultiplier: 0.2 added âœ…

- [x] **server/Services/GameConfigService.cs**

  - ExpCurve class: GrowthMultiplier property added âœ…
  - GetExpForNextLevel(): Formula fixed âœ…
    - Level 0: returns basePerLevel âœ…
    - Level 1+: returns basePerLevel _ (1 + growthMultiplier _ level) âœ…

- [x] **game/Assets/Scripts/Config/GameConfigLoader.cs**
  - ExpCurveData: growthMultiplier field added âœ…

## âœ… Database & Server Models

- [x] **server/Models/Entities/PlayerProfile.cs**

  - ExpToLevel property added âœ…

- [x] **server/Services/PlayerService.cs**

  - FindOrCreatePlayerAsync(): Calculates ExpToLevel from config âœ…
  - SaveProgressAsync(): Saves ExpToLevel âœ…

- [x] **server/Models/States/PlayerState.cs**

  - ExpToLevel property added âœ…

- [x] **server/Models/Dto/SnapshotDto.cs**
  - PlayerSnapshot: ExpToLevel parameter added âœ…

## âœ… Server Logic

- [x] **server/Services/WorldService.cs**
  - RegisterOrLoadPlayer(): Sets ExpToLevel from profile or calculates âœ…
  - CreateDefaultPlayer(): Calculates ExpToLevel from config âœ…
  - AwardKillRewards(): Updates ExpToLevel after level changes âœ…
  - GetStateSnapshot(): Includes ExpToLevel in snapshot âœ…

## âœ… Client DTOs & Sync

- [x] **game/Assets/Scripts/Net/NetClient.cs**

  - PlayerSnapshot class: expToLevel field added âœ…

- [x] **game/Assets/Scripts/Net/ServerStateApplier.cs**
  - ApplySnapshot(): Passes expToLevel to ExpManager.SyncFromServer() âœ…

## âœ… Client ExpManager (Simplified)

- [x] **game/Assets/Scripts/PlayerScripts/ExpManager.cs**
  - Removed GetExpForNextLevel() method âœ…
  - Removed OnEnemyDefeated handler âœ…
  - Removed ApplyDefaults() method âœ…
  - Removed expGrowthMultiplier field âœ…
  - Removed OnEnable/OnDisable subscriptions âœ…
  - SyncFromServer() accepts expToLevel parameter âœ…
  - SyncFromServer() uses expToLevel directly (no calculation) âœ…
  - OnLevelUp event kept for SkillTreeManager âœ…

## âœ… Integration & Validation

- [x] **game/Assets/Scripts/SkillTree/SkillTreeManager.cs**
  - Still subscribes to ExpManager.OnLevelUp âœ…
  - No changes needed (event signature unchanged) âœ…

## ğŸ“‹ Exp Curve Formula Verification

Formula: `expToLevel = basePerLevel * (1 + growthMultiplier * currentLevel)`

With basePerLevel=10, growthMultiplier=0.2:

- Level 0 â†’ 1: 10 _ (1 + 0.2 _ 0) = 10 exp âœ…
- Level 1 â†’ 2: 10 _ (1 + 0.2 _ 1) = 12 exp âœ…
- Level 2 â†’ 3: 10 _ (1 + 0.2 _ 2) = 14 exp âœ…
- Level 3 â†’ 4: 10 _ (1 + 0.2 _ 3) = 16 exp âœ…

## ğŸ” Testing Checklist

1. [ ] Server compiles without errors
2. [ ] Client compiles without errors
3. [ ] New player: ExpToLevel initialized correctly from config
4. [ ] Existing player: ExpToLevel calculated when loading from DB
5. [ ] Level up: ExpToLevel recalculated after level change
6. [ ] Client UI: Exp bar displays correct expToLevel from server
7. [ ] SkillTreeManager: Receives OnLevelUp event when level increases
8. [ ] Exp progression: Server authoritative, client displays only

## âš ï¸ Migration Notes

- Existing players in database: ExpToLevel will be 0 initially
- Server will calculate correct ExpToLevel on next state sync or kill reward
- No database migration needed (EF will handle new column on next save)
